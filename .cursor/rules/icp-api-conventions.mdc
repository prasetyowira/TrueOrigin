---
description: Best practices and naming conventions for API development in Rust-based Internet Computer (ICP) canisters
globs: *.rs,Cargo.toml
alwaysApply: false
---
---
name: icp-api-conventions.mdc
description: Quick reference and best practices for writing APIs in Rust for ICP canisters
---

# ğŸ§­ ICP API Development Conventions (Rust)

## ğŸ“˜ Overview
This reference outlines API conventions and best practices when building Rust-based canisters on the Internet Computer Protocol (ICP). It includes naming conventions, endpoint design, logging, and error handling tailored for `wasm32-unknown-unknown`.

---

## Rules:

- All code must compile for the `wasm32-unknown-unknown` target.
- All libraries must support deterministic builds and work in `no_std`-style environments.
- Use latest library versions where possible.

---

## ğŸ·ï¸ API Design Conventions

- ğŸ” Prefer **RPC-style names** for functions: `get_xyz`, `list_xyz`, `create_xyz`, `update_xyz`, `delete_xyz`
- ğŸ“¦ Always use `struct` for request payloads to improve readability and candid compatibility
- â— Separate `#[query]` and `#[update]` appropriately:
  - `#[query]` for **read-only** ops
  - `#[update]` for **state-changing** ops

```rust
#[derive(CandidType, Deserialize)]
pub struct CreateUserRequest {
    pub username: String,
    pub email: String,
}

#[update]
fn create_user(req: CreateUserRequest) -> Result<(), String> {
    ...
}
```

---

## ğŸ“¦ Payload & Argument Rules

- âœ… Use explicit structs for arguments with more than one field
- ğŸš« Avoid multiple primitives in signatures like `fn create(a: String, b: String)`
- âœ… Always derive `CandidType` and `Deserialize` for payload structs

---

## ğŸ§ª Error Handling

- âœ… Use `Result<T, String>` for all fallible endpoints
- â— Avoid panic/unwrap in canister logic (use `.map_err` or `?` with context)

```rust
#[update]
fn delete_user(id: String) -> Result<(), String> {
    USERS.with(|users| {
        users.borrow_mut()
            .remove(&id)
            .map(|_| ())
            .ok_or("User not found".into())
    })
}
```

---

## ğŸ§¹ Logging & Observability

- Use `ic_cdk::print()` for all logs (not `println!`)
- Donâ€™t log sensitive data
- âœ… Tag logs with emojis for readability (INFO, ERROR, WARN)

```rust
ic_cdk::print("ğŸ“ INFO: create_user called by principal XYZ");
ic_cdk::print("âŒ ERROR: user not found");
```

---

## ğŸ§© Structure & Modularity

Split code into:
- `lib.rs` â†’ Main entry point, module declarations
- `error.rs` â†’ Error handling
- `api.rs` â†’ endpoint definitions
- `service.rs` â†’ core logic
- `models.rs` â†’ structs/enums
- `storage.rs` â†’ stable memory + helpers to interact with it (like repository layer)
- `utils.rs` â†’ Helper functions
- `auth.rs` â†’ Authentication and authorization

---

## ğŸ“š Related Topics

- [ic-cdk](mdc:https:/docs.rs/ic-cdk)
- [candid](mdc:https:/docs.rs/candid)
- [DFINITY Rust SDK Docs](mdc:https:/internetcomputer.org/docs/current/developer-docs/backend/rust)

---

_Updated: 16-April-2025_

---
